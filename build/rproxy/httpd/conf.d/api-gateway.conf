<VirtualHost *:80>
    ServerName api.local

    ProxyPreserveHost On
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Port "80"

    #ProxyPass /api fcgi://api:9000/
    #ProxyPassReverse /api fcgi://api:9000/

    ProxyPassMatch ^/api(/.*)?$ fcgi://api:9000/var/www/html/public/index.php$1
    ProxyPassReverse /api fcgi://api:9000/

    ProxyFCGIBackendType GENERIC

    SetEnvIf Request_URI "^/api(/.*)?$" SCRIPT_FILENAME=/var/www/html/public/index.php
    SetEnvIf Request_URI "^/api(/.*)?$" DOCUMENT_ROOT=/var/www/html/public


    ErrorLog "|/usr/local/apache2/bin/rotatelogs -l /var/log/clah/api.local-error-%Y%m%d%H.log 3600"
    CustomLog "|/usr/local/apache2/bin/rotatelogs -l /var/log/clah/api.local-access-%Y%m%d%H.log 3600" combined
</VirtualHost>
